
##############################################################################
# Pad specific rules
##############################################################################

#TOP=/home/pad/mobile/project-coccinelle
WEBSITE=~/website/distrib

website:
	cp $(TMP)/$(PACKAGE).tgz                $(WEBSITE)
	cp $(TMP)/$(PACKAGE)-bin-x86.tgz        $(WEBSITE)
	cp $(TMP)/$(PACKAGE)-bin-x86-static.tgz $(WEBSITE)
	cp $(TMP)/$(PACKAGE)-bin-x86-python.tgz $(WEBSITE)
	cp $(TMP)/$(PACKAGE)-bin-bytecode-$(OCAMLVERSION).tgz          $(WEBSITE)
	cp $(TMP)/$(PACKAGE)-bin-bytecode-$(OCAMLVERSION)-python.tgz   $(WEBSITE)
	cvs add $(WEBSITE)/$(PACKAGE).tgz                              \
		$(WEBSITE)/$(PACKAGE)-bin-x86.tgz                      \
		$(WEBSITE)/$(PACKAGE)-bin-x86-static.tgz               \
		$(WEBSITE)/$(PACKAGE)-bin-x86-python.tgz               \
		$(WEBSITE)/$(PACKAGE)-bin-bytecode-$(OCAMLVERSION).tgz \
		$(WEBSITE)/$(PACKAGE)-bin-bytecode-$(OCAMLVERSION)-python.tgz
#	rm -f $(WEBSITE)/LATEST* $(WEBSITE)/coccinelle-latest.tgz
#	cp changes.txt $(WEBSITE)/changes-$(VERSION).txt
#	cd $(WEBSITE); touch LATEST_IS_$(VERSION); ln -s $(PACKAGE).tgz coccinelle-latest.tgz
#	cp readme.txt $(WEBSITE)


#TXT=$(wildcard *.txt)
syncwiki:
#	unison ~/public_html/wiki/wiki-LFS/data/pages/ docs/wiki/
#	set -e; for i in $(TXT); do unison $$i docs/wiki/$$i; done

darcsweb:
#	@echo pull from ~/public_html/darcs/c-coccinelle and c-commons and lib-xxx

DARCSFORESTS=commons ocamlsexp \
 parsing_c parsing_cocci engine

update_darcs:
	darcs pull
	set -e; for i in $(DARCSFORESTS); do cd $$i; darcs pull; cd ..; done

#darcs diff -u
diff_darcs:
	set -e; for i in $(DARCSFORESTS); do cd $$i; darcs diff -u; cd ..; done

##############################################################################
# Git Developer rules
##############################################################################
gitupdate:
	git cvsimport -d :ext:topps:/var/cvs/cocci  coccinelle

UBUNTU=karmic lucid
UBUNTURELEASE=$(UBUNTU:%=ubuntu-%)

.PHONY:: ubuntu $(UBUNTURELEASE)

ubuntu:
	for r in $(UBUNTURELEASE); do $(MAKE) $$r ; done

#$(UBUNTURELEASE):
#	debchange -c debian/changelog.karmic -D karmic -v $(VERSION).deb-0~$(@:ubuntu-%=%)~npalix1 "New release $(VERSION)"

ubuntu-karmic:
	debchange -c debian/changelog.karmic -D karmic -v $(VERSION).deb-0~$(@:ubuntu-%=%)910npalix1 "New release $(VERSION)"

ubuntu-lucid:
	debchange -c debian/changelog.lucid -D lucid -v $(VERSION).deb-0~1004npalix1 "New release $(VERSION)"

ubuntu-maverik:
	if [ ! -f debian/changelog.$(@:ubuntu-%=%) ] ; then \
		debchange --create -c debian/changelog.$(@:ubuntu-%=%) -D UNRELEASED \
			-v $(VERSION).deb-0~npalix1 "New release $(VERSION)" --package $(PRJNAME) ; \
	else \
		debchange -c debian/changelog.$(@:ubuntu-%=%) -D UNRELEASED -v $(VERSION).deb-0~npalix1 "New release $(VERSION)" ; \
	fi
