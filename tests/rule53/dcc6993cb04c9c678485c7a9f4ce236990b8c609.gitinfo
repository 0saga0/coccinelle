commit dcc6993cb04c9c678485c7a9f4ce236990b8c609
Author: Jeff Garzik <jgarzik@redhat.com>
Date:   Thu Feb 26 11:26:13 2004 -0500

    [libata] limit S/G table size to 128 entries
    
    Agreeing with Ben H's recommendation, I reduce the max-hw-segments
    number to 128, to match max-phys-segments number.  This shouldn't
    affect performance because 128*64K is far above the max transfer size
    for most current IDE devices.  Even 128*4K is OK.

diff --git a/drivers/scsi/ata_piix.c b/drivers/scsi/ata_piix.c
index 50fbfa2..6062de2 100644
--- a/drivers/scsi/ata_piix.c
+++ b/drivers/scsi/ata_piix.c
@@ -89,7 +89,7 @@ static Scsi_Host_Template piix_sht = {
 	.eh_strategy_handler	= ata_scsi_error,
 	.can_queue		= ATA_DEF_QUEUE,
 	.this_id		= ATA_SHT_THIS_ID,
-	.sg_tablesize		= ATA_MAX_PRD,
+	.sg_tablesize		= LIBATA_MAX_PRD,
 	.max_sectors		= ATA_MAX_SECTORS,
 	.cmd_per_lun		= ATA_SHT_CMD_PER_LUN,
 	.emulated		= ATA_SHT_EMULATED,
diff --git a/drivers/scsi/libata-scsi.c b/drivers/scsi/libata-scsi.c
index 5b28a33..9c615be 100644
--- a/drivers/scsi/libata-scsi.c
+++ b/drivers/scsi/libata-scsi.c
@@ -123,7 +123,7 @@ int ata_scsi_slave_config(struct scsi_de
 {
 	sdev->use_10_for_rw = 1;
 	sdev->use_10_for_ms = 1;
-	blk_queue_max_phys_segments(sdev->request_queue, ATA_MAX_PRD / 2);
+	blk_queue_max_phys_segments(sdev->request_queue, LIBATA_MAX_PRD);
 
 	return 0;	/* scsi layer doesn't check return value, sigh */
 }
diff --git a/drivers/scsi/sata_promise.c b/drivers/scsi/sata_promise.c
index 1293a3a..5fd1e9d 100644
--- a/drivers/scsi/sata_promise.c
+++ b/drivers/scsi/sata_promise.c
@@ -187,7 +187,7 @@ static Scsi_Host_Template pdc_sata_sht =
 	.eh_strategy_handler	= ata_scsi_error,
 	.can_queue		= ATA_DEF_QUEUE,
 	.this_id		= ATA_SHT_THIS_ID,
-	.sg_tablesize		= ATA_MAX_PRD,
+	.sg_tablesize		= LIBATA_MAX_PRD,
 	.max_sectors		= ATA_MAX_SECTORS,
 	.cmd_per_lun		= ATA_SHT_CMD_PER_LUN,
 	.emulated		= ATA_SHT_EMULATED,
diff --git a/drivers/scsi/sata_sil.c b/drivers/scsi/sata_sil.c
index ae14cbb..95eaaa0 100644
--- a/drivers/scsi/sata_sil.c
+++ b/drivers/scsi/sata_sil.c
@@ -127,7 +127,7 @@ static Scsi_Host_Template sil_sht = {
 	.eh_strategy_handler	= ata_scsi_error,
 	.can_queue		= ATA_DEF_QUEUE,
 	.this_id		= ATA_SHT_THIS_ID,
-	.sg_tablesize		= ATA_MAX_PRD,
+	.sg_tablesize		= LIBATA_MAX_PRD,
 	.max_sectors		= ATA_MAX_SECTORS,
 	.cmd_per_lun		= ATA_SHT_CMD_PER_LUN,
 	.emulated		= ATA_SHT_EMULATED,
diff --git a/drivers/scsi/sata_svw.c b/drivers/scsi/sata_svw.c
index 931f549..1b61d7f 100644
--- a/drivers/scsi/sata_svw.c
+++ b/drivers/scsi/sata_svw.c
@@ -222,7 +222,7 @@ static Scsi_Host_Template k2_sata_sht = 
 	.eh_strategy_handler	= ata_scsi_error,
 	.can_queue		= ATA_DEF_QUEUE,
 	.this_id		= ATA_SHT_THIS_ID,
-	.sg_tablesize		= ATA_MAX_PRD,
+	.sg_tablesize		= LIBATA_MAX_PRD,
 	.max_sectors		= ATA_MAX_SECTORS,
 	.cmd_per_lun		= ATA_SHT_CMD_PER_LUN,
 	.emulated		= ATA_SHT_EMULATED,
diff --git a/drivers/scsi/sata_via.c b/drivers/scsi/sata_via.c
index 74f717c..a6bbe9e 100644
--- a/drivers/scsi/sata_via.c
+++ b/drivers/scsi/sata_via.c
@@ -70,7 +70,7 @@ static Scsi_Host_Template svia_sht = {
 	.eh_strategy_handler	= ata_scsi_error,
 	.can_queue		= ATA_DEF_QUEUE,
 	.this_id		= ATA_SHT_THIS_ID,
-	.sg_tablesize		= ATA_MAX_PRD,
+	.sg_tablesize		= LIBATA_MAX_PRD,
 	.max_sectors		= ATA_MAX_SECTORS,
 	.cmd_per_lun		= ATA_SHT_CMD_PER_LUN,
 	.emulated		= ATA_SHT_EMULATED,
diff --git a/include/linux/libata.h b/include/linux/libata.h
index deddc26..37d958f 100644
--- a/include/linux/libata.h
+++ b/include/linux/libata.h
@@ -70,6 +70,7 @@ #define ATA_TAG_POISON		0xfafbfcfdU
 
 enum {
 	/* various global constants */
+	LIBATA_MAX_PRD		= ATA_MAX_PRD / 2,
 	ATA_MAX_PORTS		= 8,
 	ATA_DEF_QUEUE		= 1,
 	ATA_MAX_QUEUE		= 1,
